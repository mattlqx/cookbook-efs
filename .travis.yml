language: ruby
rvm:
  - 2.3
cache: bundler
sudo: false
dist: trusty

addons:
  apt:
    sources:
      - chef-stable-trusty
    packages:
      - chefdk
script:
  - /opt/chefdk/embedded/bin/rubocop --version
  - /opt/chefdk/embedded/bin/rubocop
  - /opt/chefdk/embedded/bin/foodcritic --version
  - /opt/chefdk/embedded/bin/foodcritic . --exclude spec
  - bundle exec rspec spec
before_install:
  - openssl aes-256-cbc -K $encrypted_ca75a4df0e44_key -iv $encrypted_ca75a4df0e44_iv -in supermarket.pem.enc -out supermarket.pem -d
deploy:
  provider: chef-supermarket
  user_id: mkulka
  client_key: supermarket.pem
  cookbook_category: Others
  skip_cleanup: true
  on:
    tags: true
